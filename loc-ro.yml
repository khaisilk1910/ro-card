type: custom:button-card
color_type: label-card
label: |
  [[[
    return states['sensor.rice_ro_monitor_tds_sensor'].state +' ppm';
  ]]]
name: |
  [[[
    return 'Vừa lấy '+states['sensor.rice_ro_monitor_luong_nuoc_vua_lay'].state +' L';
  ]]]
state_display: Lọc RO
variables:
  main_name: Hôm nay
  main_entity: sensor.rice_ro_monitor_luong_nuoc_tieu_thu_hom_nay
  main_icon: mdi:water
  main_icon_color: |
    [[[
      if (states['sensor.rice_ro_monitor_tds_sensor'].state > 10)
        return 'rgba(85,85,85,1)';
      return 'rgba(0,255,255,1)';
    ]]]
  main_border_radius: 50%
  main_border_color: rgba(255,255,222,1)
  main_unit: A
  main_min: 0
  main_max: 20
  main_state_font_size: 58
  main_state_color: rgba(0,0,0,1)
  main_state_font_weight: 600
  main_name_font_weight: 500
  main_name_color: rgba(0,0,0,0.6)
  main_background_color: >-
    radial-gradient(circle, rgba(0,255,222,1) 0%, rgba(62,125,111,1) 90%,
    rgba(46,182,0,1) 100%)
  water_color: |
    [[[
      if (states['sensor.rice_ro_monitor_tds_sensor'].state > 10)
        return 'rgba(85,85,85,1)';
      return 'rgba(0,255,255,1)';
    ]]]
entity: '[[[ return variables.main_entity; ]]]'
show_name: true
show_label: true
show_state: true
show_icon: false
aspect_ratio: 1/1
hold_action:
  action: more-info
styles:
  card:
    - box-shadow: |
        [[[
          return `0px 0px 3px 3px ${variables.main_border_color}`;
        ]]]
    - padding: 0px 0px 0px 0px
    - margin: auto
    - align-self: center
    - justify-self: center
    - border: none
    - border-radius: '[[[ return variables.main_border_radius; ]]]'
    - background: '[[[ return variables.main_border_color; ]]]'
  label:
    - z-index: 1
    - position: absolute
    - color: |
        [[[
          if (states['sensor.rice_ro_monitor_tds_sensor'].state > 10)
            return 'red';
          return 'rgba(255,255,255,1)';
        ]]]
    - font-size: 35px
    - font-weight: 800
    - align-self: center
    - top: 35%
  name:
    - z-index: 1
    - position: absolute
    - color: red
    - font-size: 14px
    - font-weight: 600
    - align-self: center
    - top: 58%
  state:
    - z-index: 1
    - position: absolute
    - color: yellow
    - font-size: 30px
    - font-weight: 600
    - align-self: center
    - top: 6%
  custom_fields:
    background_in_card:
      - position: absolute
      - width: calc(100%/1.02)
      - height: calc(100%/1.02)
      - padding: 0px 0px 0px 0px
      - margin: 0px 0px 0px 0px
      - background: '[[[ return variables.main_background_color; ]]]'
      - border-radius: '[[[ return variables.main_border_radius; ]]]'
      - border: none
      - align-self: center
      - justify-self: center
      - text-align: center
    info_card:
      - position: absolute
      - width: calc(100%/1.1)
      - height: calc(100%/1.1)
      - padding: 0px 0px 0px 0px
      - margin: 0px 0px 0px 0px
      - background: none
      - border-radius: '[[[ return variables.main_border_radius; ]]]'
      - border: none
      - align-self: center
      - justify-self: center
    tong:
      - position: absolute
      - justify-self: end
      - right: 4%
    thang_nay:
      - position: absolute
      - background: none
      - left: 4%
custom_fields:
  thang_nay:
    card:
      type: custom:mushroom-entity-card
      entity: sensor.luong_nuoc_tieu_thu_thang_nay
      primary_info: name
      secondary_info: state
      name: Tháng này
      icon: mdi:cup
      icon_color: yellow
      layout: vertical
      card_mod:
        style:
          .: |
            :host {
              --card-secondary-font-weight: 600 !important;
              --card-primary-font-size: 12px !important;
              --card-secondary-font-size: 14px !important;
              --card-primary-color: gray !important;
              --card-secondary-color: rgba(0,0,0,1) !important;
              --mush-icon-size: 60px !important;
            }
            ha-card {
              box-shadow: none !important;
              background: none !important;
              border: none !important;
  tong:
    card:
      type: custom:mushroom-entity-card
      entity: sensor.rice_ro_monitor_tong_luong_nuoc_tieu_thu
      primary_info: name
      secondary_info: state
      name: Tổng 02/04/2024
      icon_color: yellow
      layout: vertical
      card_mod:
        style:
          .: |
            :host {
              --card-secondary-font-weight: 600 !important;
              --card-primary-font-size: 12px !important;
              --card-secondary-font-size: 14px !important;
              --card-primary-color: gray !important;
              --card-secondary-color: rgba(0,0,0,1) !important;
              --mush-icon-size: 60px !important;
            }
            ha-card {
              box-shadow: none !important;
              background: none !important;
              border: none !important;
  background_in_card: |-
    [[[
      var speed_dur = '4s'
      if (states['binary_sensor.rice_ro_monitor_lay_nuoc'].state == 'on')
        var speed_dur = '1s'
      var current = entity.state;
      var minPosition = variables.main_min;
      var maxPosition = variables.main_max;
      var percentage = Math.floor((current - minPosition) / (maxPosition - minPosition)*100);
      var percentage1 = Math.floor((500)-(percentage*10));
      var percentage2 = percentage1;
      return `<svg width="100%" height="100%" viewBox="0 0 1000 1000"
      xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none"
      overflow="auto" shape-rendering="auto" fill="#ffffff">
        <defs>
         <path id="wavepath" d="M 0 2000 0 500 Q 150 441 300 500 t 300 0 300 0 300 0 300 0 300 0  v1000 z" />
         <path id="motionpath" d="M -216 0 0 0" />
        </defs>
        <g >
         <use xlink:href="#wavepath" y="${percentage2}" fill="${variables.water_color}">
         <animateMotion
          dur="${speed_dur}"
          repeatCount="indefinite">
          <mpath xlink:href="#motionpath" />
         </animateMotion>
         </use>
        </g>
      </svg>`;
    ]]]
  info_card:
    card:
      type: custom:button-card
      variables:
        custom_width: calc(100%/1.1)
      aspect_ratio: 1/1
      entity: '[[[ return variables.main_entity; ]]]'
      icon: '[[[ return variables.main_icon; ]]]'
      show_state: true
      show_label: false
      show_icon: true
      show_name: true
      name: '[[[ return variables.main_name; ]]]'
      styles:
        card:
          - align-self: center
          - justify-self: center
          - border-radius: '[[[ return variables.main_border_radius; ]]]'
          - border: none
          - background: none
          - padding: 0px 0px 0px 0px
          - margin: 0px 0px 0px 0px
        name:
          - position: absolute
          - top: calc(100%/1.5)
          - justify-self: center
          - font-size: '[[[ return Math.floor(variables.main_state_font_size/2)+''px''; ]]]'
          - color: '[[[ return variables.main_name_color; ]]]'
        state:
          - position: absolute
          - top: calc(100%/1.3)
          - justify-self: center
          - text-align: center
          - margin: 0px 0px 0px 0px
          - font-size: '[[[ return Math.floor(variables.main_state_font_size)+''px''; ]]]'
          - font-weight: '[[[ return variables.main_state_font_weight; ]]]'
          - color: '[[[ return variables.main_state_color; ]]]'
        img_cell:
          - position: absolute
          - top: calc(100%/60)
          - height: calc(100%/1.5)
          - background: none
          - justify-self: center
          - padding: 0px 0px 0px 0px
          - margin: 0px 0px 0px 0px
        icon:
          - align-items: end
          - width: calc(100%/1.5)
          - padding: 0px 0px 0px 0px
          - margin: 0px 0px 0px 0px
          - color: '[[[ return variables.main_icon_color; ]]]'
      tap_action:
        action: none
